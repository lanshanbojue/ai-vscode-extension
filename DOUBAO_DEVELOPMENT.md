# 豆包渠道支持开发说明

## 新增功能

本分支在AI编码助手中新增了对豆包（Doubao）AI助手的支持。豆包是字节跳动开发的大语言模型服务。

## 实现细节

### 1. 核心组件

- **DoubaoAdapter**: 豆包渠道的主适配器，实现了IChannelAdapter接口
- **DoubaoAuth**: 豆包认证管理器，处理登录状态检查和会话管理
- **DoubaoParser**: 豆包消息解析器，处理消息输入和响应解析

### 2. 功能特性

- 支持通过浏览器自动化访问豆包网页版
- 实现了流式响应和常规响应两种模式
- 支持代码上下文传递
- 实现了防反爬蛙机制（随机打字延迟等）
- 完善的错误处理和日志记录

### 3. 配置更新

- 更新了[package.json](package.json)，在默认渠道配置中新增了豆包选项
- 更新了[ChannelRegistry.ts](src/channels/ChannelRegistry.ts)，支持豆包渠道注册
- 新增了豆包相关的测试用例

## 使用方法

1. **切换到豆包渠道**：
   - 在VSCode中打开AI编码助手
   - 在渠道选择器中选择“豆包”

2. **首次使用**：
   - 系统会自动打开豆包登录页面
   - 在浏览器中完成登录
   - 返回VSCode开始使用

3. **发送消息**：
   - 在聊天界面中输入问题
   - 支持选中代码后右键菜单操作
   - 支持流式响应实时显示

## 技术实现

### 浏览器自动化

使用Puppeteer控制Chrome浏览器：
- 访问 `https://www.doubao.com`
- 自动检测登录状态
- 模拟用户输入和点击操作
- 实时抓取AI响应内容

### 反检测机制

- 随机打字延迟（50-150ms）
- 多选择器备选方案
- 人性化操作模拟

### 错误处理

- 多级重试机制
- 详细的错误日志
- 用户友好的错误提示

## 测试

运行豆包相关测试：

```bash
# 运行所有测试
npm test

# 运行豆包适配器测试
npm test -- DoubaoAdapter.test.ts
```

## 注意事项

1. **网站结构变化**：豆包网站可能会更新页面结构，导致选择器失效
2. **反爬蛙策略**：需要持续优化反检测机制
3. **性能优化**：建议在生产环境中启用浏览器实例复用

## 后续开发

- 优化豆包网页元素选择器
- 增加更多的反检测特性
- 支持豆包的高级功能（如图片识别等）
- 性能优化和缓存机制